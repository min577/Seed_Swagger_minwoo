openapi: 3.0.3
info:
  title: ğŸ… í† ë§ˆí†  ìŠ¤ë§ˆíŠ¸íŒœ API
  description: |
    ## ê°œìš”
    SEED FARM í† ë§ˆí†  ìŠ¤ë§ˆíŠ¸íŒœ ê´€ë¦¬ ì‹œìŠ¤í…œì˜ REST API ë¬¸ì„œì…ë‹ˆë‹¤.
    
    ì´ APIëŠ” n8n ì›Œí¬í”Œë¡œìš° ê¸°ë°˜ìœ¼ë¡œ êµ¬í˜„ë˜ì–´ ìˆìœ¼ë©°, ë‹¤ìŒ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤:
    
    - ğŸ¥ **ì¹´ë©”ë¼ ì œì–´**: ë¼ì¦ˆë² ë¦¬íŒŒì´ ì¹´ë©”ë¼ ì›ê²© ì œì–´
    - ğŸ“Š **ë°ì´í„° ì¡°íšŒ**: ì‹¤ì‹œê°„/íˆìŠ¤í† ë¦¬/ìš”ì•½ ë°ì´í„° ì¡°íšŒ
    - ğŸ¤– **AI ë¶„ì„**: YOLO ê¸°ë°˜ í† ë§ˆí†  ë¶„ì„, AI ì±—ë´‡
    - ğŸ’° **ì‹œì¥ ê°€ê²©**: KAMIS ë„ë§¤ê°€, ì˜¨ë¼ì¸ ê°€ê²© ë¹„êµ
    - ğŸŒ± **ìˆ˜í™•ëŸ‰ ì˜ˆì¸¡**: ML ëª¨ë¸ ê¸°ë°˜ ì˜ˆì¸¡
    - ğŸ“ **ë†ì¥ ì¼ì§€**: ì¼ì§€ ì¡°íšŒ/ì €ì¥
    
    ## ì„œë²„ í™˜ê²½
    - **ìš´ì˜ ì„œë²„**: http://seedfarm.co.kr:5678
    - **ë‚´ë¶€ ì„œë²„**: http://192.168.49.101:5679
    
    ## ì¸ì¦
    í˜„ì¬ API í‚¤ ì¸ì¦ì´ í•„ìš”í•œ ì—”ë“œí¬ì¸íŠ¸ëŠ” `api_key` íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
    
  version: 1.0.0
  contact:
    name: SEED FARM ê°œë°œíŒ€
    email: dev@seedfarm.co.kr
  license:
    name: ISC

servers:
  - url: http://seedfarm.co.kr:5678/webhook
    description: ìš´ì˜ ì„œë²„ (ì™¸ë¶€ ì ‘ê·¼ìš©)
  - url: http://192.168.49.101:5679/webhook
    description: ë‚´ë¶€ ì„œë²„ (ì‚¬ë‚´ë§ ì „ìš©)

tags:
  - name: ğŸ“Š Data
    description: í† ë§ˆí†  ë¶„ì„ ë°ì´í„° ì¡°íšŒ API
  - name: ğŸ¥ Camera
    description: ë¼ì¦ˆë² ë¦¬íŒŒì´ ì¹´ë©”ë¼ ì œì–´ API
  - name: ğŸ¤– AI
    description: AI ì±—ë´‡ ë° ì´ë¯¸ì§€ ë¶„ì„ API
  - name: ğŸ’° Market
    description: ì‹œì¥ ê°€ê²© ì •ë³´ API
  - name: ğŸŒ± Prediction
    description: ìˆ˜í™•ëŸ‰ ì˜ˆì¸¡ API
  - name: ğŸ“ Diary
    description: ë†ì¥ ì¼ì§€ API
  - name: ğŸ  Home
    description: ì•± í™ˆ í™”ë©´ìš© í†µí•© API

paths:
  # ===== ë°ì´í„° ì¡°íšŒ API =====
  /data-realtime:
    get:
      tags:
        - ğŸ“Š Data
      summary: ì‹¤ì‹œê°„ í† ë§ˆí†  ë¶„ì„ ë°ì´í„° ì¡°íšŒ
      description: |
        ìµœê·¼ 1ì‹œê°„ ì´ë‚´ì˜ ë§ˆì§€ë§‰ YOLO ë¶„ì„ ê²°ê³¼ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
        
        **ë°ì´í„° ì¶œì²˜**: InfluxDB (bucket: minwoo, measurement: predict)
      operationId: getRealtimeData
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TomatoData'
              example:
                Ready: 45
                Not_Ready: 23
                Disease_Bad: 2
                Truss: 8
        '500':
          description: ì„œë²„ ì˜¤ë¥˜
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /data-history:
    get:
      tags:
        - ğŸ“Š Data
      summary: ê³¼ê±° í† ë§ˆí†  ë¶„ì„ ë°ì´í„° ì¡°íšŒ
      description: |
        ì§€ì •ëœ ì‹œê°„ ë²”ìœ„ì˜ ì‹œê³„ì—´ ë°ì´í„°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
        
        **ì‚¬ìš© ì˜ˆì‹œ**:
        - ìµœê·¼ 30ë¶„: `?hours=0.5`
        - ìµœê·¼ 24ì‹œê°„: `?hours=24`
        - ìµœê·¼ 1ì£¼ì¼: `?hours=168`
      operationId: getHistoryData
      parameters:
        - name: hours
          in: query
          description: ì¡°íšŒ ê¸°ê°„ (ì‹œê°„ ë‹¨ìœ„)
          required: false
          schema:
            type: number
            default: 1
            example: 24
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/TomatoDataWithTime'
              example:
                data:
                  - time: "2024-11-21T06:00:00Z"
                    Ready: 40
                    Not_Ready: 20
                    Disease_Bad: 1
                    Truss: 7
                  - time: "2024-11-21T06:10:00Z"
                    Ready: 42
                    Not_Ready: 21
                    Disease_Bad: 1
                    Truss: 7

  /data-summary:
    get:
      tags:
        - ğŸ“Š Data
      summary: ì˜¤ëŠ˜ ì¼ì¼ ìš”ì•½ ë°ì´í„° ì¡°íšŒ
      description: |
        ì˜¤ëŠ˜ 00:00:00 (KST) ë¶€í„° í˜„ì¬ê¹Œì§€ì˜ ëˆ„ì  ë°ì´í„°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
      operationId: getDailySummary
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DailySummary'
              example:
                total_ready: 450
                total_not_ready: 230
                total_disease: 15
                avg_truss: 8

  # ===== ì¹´ë©”ë¼ ì œì–´ API =====
  /camera-capture:
    post:
      tags:
        - ğŸ¥ Camera
      summary: ì¦‰ì‹œ ì´¬ì˜ ë° ë¶„ì„
      description: |
        ë¼ì¦ˆë² ë¦¬íŒŒì´ ì¹´ë©”ë¼ë¡œ ì¦‰ì‹œ ì´¬ì˜í•˜ê³  YOLO ë¶„ì„ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
        
        **ì²˜ë¦¬ ìˆœì„œ**:
        1. ë¼ì¦ˆë² ë¦¬íŒŒì´ ìŠ¤ëƒ…ìƒ· ìš”ì²­
        2. YOLO ì„œë²„ë¡œ ì´ë¯¸ì§€ ì „ì†¡
        3. ë¶„ì„ ê²°ê³¼ InfluxDB ì €ì¥
        4. ê²°ê³¼ ë°˜í™˜
      operationId: captureNow
      responses:
        '200':
          description: ì´¬ì˜ ë° ë¶„ì„ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CaptureResponse'
              example:
                success: true
                data:
                  Ready: 35
                  Not_Ready: 18
                  Disease_Bad: 2
                  Truss: 6
                  ripeness_rate: 66
                  disease_rate: 4
                timestamp: "2024-11-21T07:30:00Z"
        '500':
          description: ì´¬ì˜ ì‹¤íŒ¨

  /capture-test:
    post:
      tags:
        - ğŸ¥ Camera
      summary: í…ŒìŠ¤íŠ¸ ì´¬ì˜ (ëœë¤ ë°ì´í„°)
      description: |
        ë¼ì¦ˆë² ë¦¬íŒŒì´ ì—†ì´ í…ŒìŠ¤íŠ¸ìš© ëœë¤ ë°ì´í„°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
        
        **ê°œë°œ/í…ŒìŠ¤íŠ¸ ìš©ë„**ë¡œë§Œ ì‚¬ìš©í•˜ì„¸ìš”.
      operationId: captureTest
      responses:
        '200':
          description: í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  timestamp:
                    type: string
                    format: date-time
                  data:
                    $ref: '#/components/schemas/TomatoData'

  /camera-start:
    post:
      tags:
        - ğŸ¥ Camera
      summary: ìë™ ëª¨ë‹ˆí„°ë§ ì‹œì‘
      description: ì„¤ì •ëœ ê°„ê²©ìœ¼ë¡œ ìë™ ì´¬ì˜ì„ ì‹œì‘í•©ë‹ˆë‹¤.
      operationId: startMonitoring
      responses:
        '200':
          description: ëª¨ë‹ˆí„°ë§ ì‹œì‘ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CameraStatusResponse'

  /camera-stop:
    post:
      tags:
        - ğŸ¥ Camera
      summary: ìë™ ëª¨ë‹ˆí„°ë§ ì¤‘ì§€
      description: ìë™ ì´¬ì˜ì„ ì¤‘ì§€í•©ë‹ˆë‹¤.
      operationId: stopMonitoring
      responses:
        '200':
          description: ëª¨ë‹ˆí„°ë§ ì¤‘ì§€ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CameraStatusResponse'

  /camera-status:
    get:
      tags:
        - ğŸ¥ Camera
      summary: ì¹´ë©”ë¼ ìƒíƒœ ì¡°íšŒ
      description: í˜„ì¬ ì¹´ë©”ë¼ì˜ ëª¨ë‹ˆí„°ë§ ìƒíƒœ, ì„¤ì •ì„ ì¡°íšŒí•©ë‹ˆë‹¤.
      operationId: getCameraStatus
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CameraStatus'
              example:
                monitoring: true
                interval: 600
                last_capture: "2024-11-21T07:20:00Z"
                white_balance: "auto"

  /camera-interval:
    post:
      tags:
        - ğŸ¥ Camera
      summary: ì´¬ì˜ ê°„ê²© ì„¤ì •
      description: |
        ìë™ ì´¬ì˜ ê°„ê²©ì„ ì„¤ì •í•©ë‹ˆë‹¤.
        
        **í—ˆìš© ê°’**: 60(1ë¶„), 300(5ë¶„), 600(10ë¶„), 1800(30ë¶„), 3600(1ì‹œê°„)
      operationId: setCaptureInterval
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - interval
              properties:
                interval:
                  type: integer
                  description: ì´¬ì˜ ê°„ê²© (ì´ˆ)
                  enum: [60, 300, 600, 1800, 3600]
                  example: 600
      responses:
        '200':
          description: ì„¤ì • ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CameraStatusResponse'

  /camera-white-balance:
    post:
      tags:
        - ğŸ¥ Camera
      summary: í™”ì´íŠ¸ ë°¸ëŸ°ìŠ¤ ì„¤ì •
      description: ì¹´ë©”ë¼ í™”ì´íŠ¸ ë°¸ëŸ°ìŠ¤ ëª¨ë“œë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
      operationId: setWhiteBalance
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - mode
              properties:
                mode:
                  type: string
                  description: í™”ì´íŠ¸ ë°¸ëŸ°ìŠ¤ ëª¨ë“œ
                  enum: [auto, fluorescent, tungsten, daylight]
                  example: auto
      responses:
        '200':
          description: ì„¤ì • ì„±ê³µ

  # ===== AI API =====
  /chat-message:
    post:
      tags:
        - ğŸ¤– AI
      summary: AI ì±—ë´‡ ë©”ì‹œì§€ ì „ì†¡
      description: |
        í† ë§ˆí†  ì¬ë°° ì „ë¬¸ AI ì–´ì‹œìŠ¤í„´íŠ¸ì—ê²Œ ì§ˆë¬¸í•©ë‹ˆë‹¤.
        
        **ì§€ì› ê¸°ëŠ¥**:
        - í…ìŠ¤íŠ¸ë§Œ ì „ì†¡
        - í…ìŠ¤íŠ¸ + ì´ë¯¸ì§€ ì „ì†¡ (í† ë§ˆí†  ë¶„ì„ ìš”ì²­)
        - ì´ë¯¸ì§€ë§Œ ì „ì†¡ (ìë™ YOLO ë¶„ì„)
        
        **íŠ¹ìˆ˜ ê¸°ëŠ¥**:
        - ìƒìœ¡ ë°ì´í„° í¬í•¨ ì‹œ ìˆ˜í™•ëŸ‰ ì˜ˆì¸¡ API ìë™ í˜¸ì¶œ
        - ì´ë¯¸ì§€ í¬í•¨ ì‹œ YOLO ë¶„ì„ í›„ ê²°ê³¼ ê¸°ë°˜ ë‹µë³€
      operationId: sendChatMessage
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                message:
                  type: string
                  description: ì‚¬ìš©ì ë©”ì‹œì§€
                  example: "í˜„ì¬ ì˜¨ë„ 25ë„, ìŠµë„ 70%ì¼ ë•Œ ì˜ˆìƒ ìˆ˜í™•ëŸ‰ì€?"
                image:
                  type: string
                  format: binary
                  description: í† ë§ˆí†  ì´ë¯¸ì§€ (JPEG)
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatResponse'
              example:
                response: "í˜„ì¬ í™˜ê²½ì—ì„œ ì˜ˆìƒ ìˆ˜í™•ëŸ‰ì€ ì•½ 8.5kg/3.3ã¡ ì…ë‹ˆë‹¤. ğŸ… ì˜¨ë„ê°€ ì ì • ë²”ìœ„(25-28Â°C)ì— ìˆì–´ ì–‘í˜¸í•©ë‹ˆë‹¤..."
                timestamp: "2024-11-21T07:30:00Z"
                success: true

  /capture-analyze:
    post:
      tags:
        - ğŸ¤– AI
      summary: ì´ë¯¸ì§€ YOLO ë¶„ì„ (FormData)
      description: |
        ì´ë¯¸ì§€ íŒŒì¼ì„ YOLO ëª¨ë¸ë¡œ ë¶„ì„í•©ë‹ˆë‹¤.
        
        **multipart/form-data** í˜•ì‹ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ì „ì†¡í•˜ì„¸ìš”.
        
        **ì§€ì› í˜•ì‹**: JPEG, PNG
      operationId: analyzeImage
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - image
              properties:
                image:
                  type: string
                  format: binary
                  description: í† ë§ˆí†  ì´ë¯¸ì§€ íŒŒì¼ (JPEG, PNG)
      responses:
        '200':
          description: ë¶„ì„ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalysisResponse'

  /disease-diagnosis:
    post:
      tags:
        - ğŸ¤– AI
      summary: ë³‘í•´ì¶© ì§„ë‹¨ (Base64)
      description: |
        í† ë§ˆí†  ì´ë¯¸ì§€ë¥¼ AIê°€ ë¶„ì„í•˜ì—¬ ë³‘í•´ì¶© ìƒíƒœë¥¼ ì§„ë‹¨í•©ë‹ˆë‹¤.
        
        **application/json** í˜•ì‹ìœ¼ë¡œ Base64 ì¸ì½”ë”©ëœ ì´ë¯¸ì§€ë¥¼ ì „ì†¡í•˜ì„¸ìš”.
        
        **ì§„ë‹¨ í•­ëª©**:
        - ê±´ê°• ìƒíƒœ í‰ê°€ (ê±´ê°•/ì£¼ì˜/ìœ„í—˜)
        - ë°œê²¬ëœ ì¦ìƒ
        - ì›ì¸ ë¶„ì„
        - ê¸´ê¸‰ ì¡°ì¹˜ ì‚¬í•­
        - ì¹˜ë£Œ ë°©ë²•
        - ì˜ˆë°© ê´€ë¦¬
      operationId: diagnoseDisease
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - image
              properties:
                image:
                  type: string
                  description: "Base64 ì¸ì½”ë”©ëœ ì´ë¯¸ì§€ ë°ì´í„° (data: prefix ì œì™¸)"
                  example: "/9j/4AAQSkZJRgABAQAAAQABAAD..."
                mimeType:
                  type: string
                  description: ì´ë¯¸ì§€ MIME íƒ€ì…
                  default: "image/jpeg"
                  example: "image/jpeg"
      responses:
        '200':
          description: ì§„ë‹¨ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DiagnosisResponse'

  /raspberry-image:
    post:
      tags:
        - ğŸ¤– AI
      summary: ë¼ì¦ˆë² ë¦¬íŒŒì´ ì´ë¯¸ì§€ ìˆ˜ì‹ 
      description: |
        ë¼ì¦ˆë² ë¦¬íŒŒì´ì—ì„œ ì´¬ì˜í•œ ì´ë¯¸ì§€ë¥¼ ìˆ˜ì‹ í•˜ê³  ìë™ ë¶„ì„í•©ë‹ˆë‹¤.
        
        **ë‚´ë¶€ ì²˜ë¦¬ ìˆœì„œ**:
        1. ì´ë¯¸ì§€ ìˆ˜ì‹ 
        2. YOLO ë¶„ì„
        3. InfluxDB ì €ì¥
        4. ì´ë¯¸ì§€ íŒŒì¼ ì €ì¥ (ê¹€ì œ ì‹¤ì¦ ë°ì´í„°)
      operationId: receiveRaspberryImage
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - image
              properties:
                image:
                  type: string
                  format: binary
                  description: ì´¬ì˜ëœ ì´ë¯¸ì§€ íŒŒì¼
      responses:
        '200':
          description: ì²˜ë¦¬ ì™„ë£Œ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  timestamp:
                    type: string
                    format: date-time

  # ===== ì‹œì¥ ê°€ê²© API =====
  /market-price:
    get:
      tags:
        - ğŸ’° Market
      summary: ì‹¤ì‹œê°„ ì‹œì¥ ê°€ê²© ì¡°íšŒ
      description: |
        KAMIS APIë¥¼ í†µí•´ ì˜¤ëŠ˜ì˜ í† ë§ˆí†  ë„ë§¤ ì‹œì¥ ê°€ê²©ì„ ì¡°íšŒí•©ë‹ˆë‹¤.
        
        **ë°ì´í„° ì¶œì²˜**: ë†ì‚°ë¬¼ìœ í†µì •ë³´(KAMIS)
      operationId: getMarketPrice
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MarketPrice'

  /price-compare:
    get:
      tags:
        - ğŸ’° Market
      summary: ë„ë§¤ê°€ vs ì˜¨ë¼ì¸ê°€ ë¹„êµ
      description: |
        KAMIS ë„ë§¤ ê°€ê²©ê³¼ ë„¤ì´ë²„ ì‡¼í•‘ ì˜¨ë¼ì¸ ê°€ê²©ì„ ë¹„êµí•©ë‹ˆë‹¤.
        
        **ë¹„êµ í•­ëª©**:
        - ë„ë§¤ê°€ (ìƒí’ˆ/ì¤‘í’ˆ/ë°©ìš¸í† ë§ˆí† )
        - ì˜¨ë¼ì¸ ìµœì €ê°€/ì¤‘ê°„ê°€/ìµœê³ ê°€
        - ë§ˆì§„ìœ¨ ê³„ì‚°
      operationId: getPriceCompare
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PriceCompare'

  /price-history:
    get:
      tags:
        - ğŸ’° Market
      summary: ê°€ê²© ì¶”ì´ ì¡°íšŒ
      description: |
        ê¸°ê°„ë³„ í† ë§ˆí†  ê°€ê²© ì¶”ì´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
        
        **ê¸°ë³¸ê°’**: ìµœê·¼ 7ì¼
      operationId: getPriceHistory
      parameters:
        - name: start
          in: query
          description: ì‹œì‘ì¼ (YYYY-MM-DD)
          schema:
            type: string
            format: date
            example: "2024-11-14"
        - name: end
          in: query
          description: ì¢…ë£Œì¼ (YYYY-MM-DD)
          schema:
            type: string
            format: date
            example: "2024-11-21"
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PriceHistory'

  # ===== ìˆ˜í™•ëŸ‰ ì˜ˆì¸¡ API =====
  /yield-prediction:
    post:
      tags:
        - ğŸŒ± Prediction
      summary: ìˆ˜í™•ëŸ‰ ì˜ˆì¸¡
      description: |
        í™˜ê²½ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ML ëª¨ë¸ì´ ì˜ˆìƒ ìˆ˜í™•ëŸ‰ì„ ì˜ˆì¸¡í•©ë‹ˆë‹¤.
        
        **ëª¨ë¸ ì •ë³´**:
        - ì•Œê³ ë¦¬ì¦˜: Random Forest
        - í•™ìŠµ ë°ì´í„°: ë†ì´Œì§„í¥ì²­ ìŠ¤ë§ˆíŠ¸íŒœ DB (103,000+ ë°ì´í„°)
        - ì •í™•ë„: RÂ² = 0.9084
        
        **í•„ìˆ˜ ì…ë ¥**: ì˜¨ë„, ìŠµë„
        **ì„ íƒ ì…ë ¥**: CO2, ì¼ì‚¬ëŸ‰, ìƒìœ¡ë‹¨ê³„, ì‹œì„¤íƒ€ì…
      operationId: predictYield
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/YieldPredictionRequest'
      responses:
        '200':
          description: ì˜ˆì¸¡ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/YieldPredictionResponse'

  # ===== ë†ì¥ ì¼ì§€ API =====
  /app/diary:
    get:
      tags:
        - ğŸ“ Diary
      summary: ì¼ì§€ ëª©ë¡ ì¡°íšŒ
      description: ìµœê·¼ Nì¼ê°„ì˜ ë†ì¥ ì¼ì§€ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
      operationId: getDiaryList
      parameters:
        - name: days
          in: query
          description: ì¡°íšŒ ê¸°ê°„ (ì¼)
          schema:
            type: integer
            default: 7
            example: 7
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DiaryListResponse'
    post:
      tags:
        - ğŸ“ Diary
      summary: ì¼ì§€ ì €ì¥
      description: ë‹¹ì¼ ë†ì¥ ì¼ì§€ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
      operationId: saveDiary
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DiaryEntry'
      responses:
        '200':
          description: ì €ì¥ ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  saved:
                    $ref: '#/components/schemas/DiaryEntry'

  # ===== í™ˆ í™”ë©´ API =====
  /app/home:
    get:
      tags:
        - ğŸ  Home
      summary: í™ˆ í™”ë©´ í†µí•© ë°ì´í„°
      description: |
        ì•± í™ˆ í™”ë©´ì— í•„ìš”í•œ ëª¨ë“  ë°ì´í„°ë¥¼ í•œ ë²ˆì— ë°˜í™˜í•©ë‹ˆë‹¤.
        
        **í¬í•¨ ë°ì´í„°**:
        - ì‹¤ì‹œê°„ í† ë§ˆí†  ë¶„ì„ ê²°ê³¼
        - ì˜¤ëŠ˜ ìš”ì•½ í†µê³„
        - ì•Œë¦¼ ëª©ë¡
        - ìŠ¤íŠ¸ë¦¬ë° URL
      operationId: getHomeData
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HomeData'

  /app/chat:
    post:
      tags:
        - ğŸ  Home
      summary: ì•±ìš© ê°„í¸ ì±„íŒ…
      description: |
        ì•±ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê°„í¸ ì±„íŒ… APIì…ë‹ˆë‹¤.
        
        **ì°¸ê³ **: API í‚¤ ê²€ì¦ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
      operationId: appChat
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - message
              properties:
                message:
                  type: string
                  example: "ì˜¤ëŠ˜ í† ë§ˆí†  ìƒíƒœ ì–´ë•Œ?"
                api_key:
                  type: string
                  example: "tomato-farm-2024"
      responses:
        '200':
          description: ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatResponse'

  /app/analyze:
    post:
      tags:
        - ğŸ  Home
      summary: ì•±ìš© ì´ë¯¸ì§€ ë¶„ì„
      description: ì•±ì—ì„œ ì´¬ì˜í•œ ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.
      operationId: appAnalyze
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: ë¶„ì„ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalysisResponse'

# ===== ì»´í¬ë„ŒíŠ¸ ì •ì˜ =====
components:
  schemas:
    TomatoData:
      type: object
      description: í† ë§ˆí†  ë¶„ì„ ê²°ê³¼ (YOLO 4-class)
      properties:
        Ready:
          type: integer
          description: ìˆ˜í™• ê°€ëŠ¥í•œ ì™„ìˆ™ í† ë§ˆí†  ê°œìˆ˜
          example: 45
        Not_Ready:
          type: integer
          description: ë¯¸ì„±ìˆ™ í† ë§ˆí†  ê°œìˆ˜
          example: 23
        Disease_Bad:
          type: integer
          description: ë³‘í•´ì¶© ê°ì—¼ í† ë§ˆí†  ê°œìˆ˜
          example: 2
        Truss:
          type: integer
          description: í™”ë°© (ê½ƒë´‰ìš°ë¦¬) ê°œìˆ˜
          example: 8

    TomatoDataWithTime:
      allOf:
        - $ref: '#/components/schemas/TomatoData'
        - type: object
          properties:
            time:
              type: string
              format: date-time
              description: ì¸¡ì • ì‹œê°„
              example: "2024-11-21T06:00:00Z"

    TomatoDataLowerCase:
      type: object
      description: í† ë§ˆí†  ë¶„ì„ ê²°ê³¼ (ì†Œë¬¸ì ë²„ì „ - ì•±ìš©)
      properties:
        ready:
          type: integer
          example: 45
        not_ready:
          type: integer
          example: 23
        disease:
          type: integer
          example: 2
        truss:
          type: integer
          example: 8

    DailySummary:
      type: object
      properties:
        total_ready:
          type: integer
          description: ì˜¤ëŠ˜ ëˆ„ì  ìˆ˜í™• ê°€ëŠ¥ í† ë§ˆí† 
        total_not_ready:
          type: integer
          description: ì˜¤ëŠ˜ ëˆ„ì  ë¯¸ì„±ìˆ™ í† ë§ˆí† 
        total_disease:
          type: integer
          description: ì˜¤ëŠ˜ ëˆ„ì  ë³‘í•´ í† ë§ˆí† 
        avg_truss:
          type: integer
          description: í‰ê·  í™”ë°© ìˆ˜

    CaptureResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            Ready:
              type: integer
            Not_Ready:
              type: integer
            Disease_Bad:
              type: integer
            Truss:
              type: integer
            ripeness_rate:
              type: integer
              description: ì„±ìˆ™ë„ (%)
            disease_rate:
              type: integer
              description: ë³‘í•´ìœ¨ (%)
        timestamp:
          type: string
          format: date-time

    CameraStatus:
      type: object
      properties:
        monitoring:
          type: boolean
          description: ìë™ ëª¨ë‹ˆí„°ë§ í™œì„±í™” ì—¬ë¶€
        interval:
          type: integer
          description: ì´¬ì˜ ê°„ê²© (ì´ˆ)
        last_capture:
          type: string
          format: date-time
          description: ë§ˆì§€ë§‰ ì´¬ì˜ ì‹œê°„
        white_balance:
          type: string
          enum: [auto, fluorescent, tungsten, daylight]
          description: í™”ì´íŠ¸ ë°¸ëŸ°ìŠ¤ ëª¨ë“œ

    CameraStatusResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string

    ChatResponse:
      type: object
      properties:
        response:
          type: string
          description: AI ì‘ë‹µ ë©”ì‹œì§€
        timestamp:
          type: string
          format: date-time
        success:
          type: boolean

    AnalysisResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object
          properties:
            Ready:
              type: integer
            Not_Ready:
              type: integer
            Disease_Bad:
              type: integer
            Truss:
              type: integer
            ripeness_rate:
              type: integer
            disease_rate:
              type: integer

    DiagnosisResponse:
      type: object
      properties:
        success:
          type: boolean
        diagnosis:
          type: string
          description: AI ë³‘í•´ì¶© ì§„ë‹¨ ê²°ê³¼ (ë§ˆí¬ë‹¤ìš´ í˜•ì‹)
        healthStatus:
          type: string
          enum: [ê±´ê°•, ì£¼ì˜, ìœ„í—˜, ì˜¤ë¥˜]
          description: ê±´ê°• ìƒíƒœ íŒì •
        timestamp:
          type: string
          format: date-time

    MarketPrice:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            item_name:
              type: string
              example: "í† ë§ˆí† "
            kind_name:
              type: string
              example: "ì™„ìˆ™í† ë§ˆí† "
            unit:
              type: string
              example: "5kg"
            rank:
              type: string
              example: "ìƒí’ˆ"
            price:
              type: integer
              description: ì˜¤ëŠ˜ ê°€ê²© (ì›/kg)
              example: 3500
            yesterday_price:
              type: integer
              description: ì–´ì œ ê°€ê²©
            change:
              type: integer
              description: ê°€ê²© ë³€ë™
            change_rate:
              type: number
              description: ë³€ë™ë¥  (%)
            direction:
              type: string
              enum: [up, down, same]
            date:
              type: string
              format: date

    PriceCompare:
      type: object
      properties:
        success:
          type: boolean
        date:
          type: string
          format: date
        wholesale_summary:
          type: object
          description: ë„ë§¤ê°€ ìš”ì•½ (ì›/kg)
          properties:
            high:
              type: integer
              description: ìƒí’ˆ
            mid:
              type: integer
              description: ì¤‘í’ˆ
            cherry:
              type: integer
              description: ë°©ìš¸í† ë§ˆí† 
        online_summary:
          type: object
          description: ì˜¨ë¼ì¸ê°€ ìš”ì•½
          properties:
            lowest_price:
              type: integer
            lowest_mall:
              type: string
            median_price:
              type: integer
            average_price:
              type: integer
            mall_count:
              type: integer
        comparison:
          type: array
          items:
            type: object
            properties:
              grade:
                type: string
              wholesale_price:
                type: integer
              online_lowest:
                type: integer
              margin_rate:
                type: integer
                description: ë§ˆì§„ìœ¨ (%)

    PriceHistory:
      type: object
      properties:
        success:
          type: boolean
        period:
          type: object
          properties:
            start:
              type: string
              format: date
            end:
              type: string
              format: date
        count:
          type: integer
          description: ë°ì´í„° ê±´ìˆ˜
        stats:
          type: object
          properties:
            high:
              $ref: '#/components/schemas/PriceStats'
            mid:
              $ref: '#/components/schemas/PriceStats'
            cherry:
              $ref: '#/components/schemas/PriceStats'
        data:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
              high:
                type: integer
              mid:
                type: integer
              cherry:
                type: integer

    PriceStats:
      type: object
      properties:
        min:
          type: integer
        max:
          type: integer
        avg:
          type: integer
        change:
          type: integer
          description: ê¸°ê°„ ë‚´ ë³€ë™

    YieldPredictionRequest:
      type: object
      required:
        - temperature
        - humidity
      properties:
        month:
          type: integer
          description: ì›” (1-12)
          example: 11
        temperature:
          type: number
          description: ì˜¨ë„ (Â°C)
          example: 25.5
        humidity:
          type: number
          description: ìŠµë„ (%)
          example: 70
        co2:
          type: number
          description: CO2 ë†ë„ (ppm)
          default: 700
          example: 800
        solar_radiation:
          type: number
          description: ì¼ì‚¬ëŸ‰ (J/ã /day)
          default: 1200
          example: 1500
        growth_stage:
          type: string
          description: ìƒìœ¡ ë‹¨ê³„
          enum:
            - ìƒìœ¡ì´ˆê¸°
            - ìƒìœ¡ì¤‘ê¸°(9~10ì›”)
            - ìƒìœ¡ì¤‘ê¸°(11~12ì›”)
            - ìƒìœ¡ì¤‘ê¸°(1~2ì›”)
            - ìƒìœ¡ì¤‘ê¸°(3~6ì›”)
            - ìƒìœ¡ë§ê¸°(7~8ì›”)
          example: "ìƒìœ¡ì¤‘ê¸°(11~12ì›”)"
        facility_type:
          type: string
          description: ì‹œì„¤ íƒ€ì…
          enum:
            - ë¹„ë‹í•˜ìš°ìŠ¤
            - ìœ ë¦¬ì˜¨ì‹¤
          default: ë¹„ë‹í•˜ìš°ìŠ¤

    YieldPredictionResponse:
      type: object
      properties:
        predicted_yield:
          type: number
          description: ì˜ˆì¸¡ ìˆ˜í™•ëŸ‰ (kg/3.3ã¡)
          example: 8.52
        confidence_interval:
          type: object
          properties:
            lower:
              type: number
              description: í•˜í•œê°’
            upper:
              type: number
              description: ìƒí•œê°’
            std_dev:
              type: number
              description: í‘œì¤€í¸ì°¨
        input_summary:
          type: object
          description: ì…ë ¥ ë°ì´í„° ìš”ì•½
        recommendations:
          type: array
          items:
            type: string
          description: AI ì¶”ì²œ ì‚¬í•­

    DiaryEntry:
      type: object
      properties:
        date:
          type: string
          format: date
          description: ì¼ì§€ ë‚ ì§œ
        harvest_kg:
          type: number
          description: ìˆ˜í™•ëŸ‰ (kg)
        memo:
          type: string
          description: ë©”ëª¨

    DiaryListResponse:
      type: object
      properties:
        success:
          type: boolean
        entries:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
              ready:
                type: integer
              not_ready:
                type: integer
              disease:
                type: integer
              truss:
                type: integer
              memo:
                type: string
        total_days:
          type: integer

    HomeData:
      type: object
      properties:
        success:
          type: boolean
        realtime:
          $ref: '#/components/schemas/TomatoDataLowerCase'
        today_summary:
          type: object
          properties:
            total_detected:
              type: integer
            total_ready:
              type: integer
            total_disease:
              type: integer
            harvest_rate:
              type: number
        alerts:
          type: array
          items:
            type: object
            properties:
              type:
                type: string
                enum: [disease, harvest, warning]
              message:
                type: string
              time:
                type: string
                format: date-time
              severity:
                type: string
                enum: [low, medium, high, info]
        stream_url:
          type: string
          description: ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° URL
        last_updated:
          type: string
          format: date-time

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          description: ì—ëŸ¬ ë©”ì‹œì§€
        code:
          type: string
          description: ì—ëŸ¬ ì½”ë“œ